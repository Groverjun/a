<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="static/css/visitorStyle.css"/>
	</head>
	<body>
		<div style="height: 5000px;">
			<a href="javascript:void(0)" id="abt">
				打开
			</a>
		</div>
		<div class="visitor">
			<style id="scrollbar"></style>
			<div id="visitor_height">
				<div class="visitor_box">
					<h2 class="visitorH1 clearfix"><i></i>访客回访 </h2>
					<div class="informaction informactionOne">
						<h2 class="visitorH2"><i></i>原商机信息<a href="javascript:void(0)" class="clearDiv" index="0">收起</a></h2>
						<div class="top">
							<div class="visitorList clearfix">
								<ul>
									<li><label>所属渠道：</label><span>上海力企</span></li>
									<li><label>主营业务：</label><span>各种门</span></li>
									<li><label>来源：</label><input type="text" /></li>
								</ul>
								<ul>
									<li><label>客户名称：</label><span>创纪文化传播（上海）有限公司</span></li>
									<li><label>服务地域：</label><span>华东地区</span></li>
									<li><label>商机类型：</label><span>回拨电话</span></li>
								</ul>
							</div>
							<div class="visitorBg">
								<ul>
									<li>
										<label>时间：</label>
										<span>2018-09-10  08:27:22</span>
									</li>
									<li>
										<label>内容：</label>
										<span>访客电话：18605883667；通话开始时间：2018-09-10  08:27:54；</span>
									</li>
								</ul>
								<ol class="clearfix">
									<li>
										<label>搜索词：</label>
										<span>电梯门套效果图</span>
									</li>
									<li>
										<label>搜索词：</label>
										<span>电梯门套效果图</span>
									</li>
									<li>
										<label>来源地域：</label>
										<span>中国  湖北  武汉</span>
									</li>
								</ol>
							</div>							
						</div>
					</div>
					<div class="informaction informactionTable" style="padding-bottom: 0;">
						<h2 class="visitorH2 clearfix"><i></i>商机回访记录<a href="javascript:void(0)" class="clearDiv" index="1">收起</a></h2>
						<div class="top">
							<table border="0" cellspacing="0" cellpadding="0">
								<thead>
									<tr>
										<th>序号</th>
										<th>产品类型</th>
										<th>回访类型</th>
										<th>操作时间</th>
										<th>回访情况</th>
										<th>生意帮是否可见</th>
										<th class="informactionTable_th">详情</th>
										<th>操作人</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<th>1</th>
										<th></th>
										<th>回访类型</th>
										<th></th>
										<th></th>
										<th></th>
										<th></th>
										<th></th>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="informaction informactionTow">
						<h2 class="visitorH2 clearfix"><i></i>商机挖掘操作<a href="javascript:void(0)" class="clearDiv" index="2">收起</a></h2>
						<div class="top">
							<div class="informactionTow_tabHead">
								<div class="check clearfix">
									<label>挖掘状态：</label>
									<div class="listCheckbox">
										<ul class="clearfix">
											<li><input type="radio" name="b" id="chec01"/><label for="chec01">原商机在</label></li>
											<li><input type="radio" name="b" id="chec02"/><label for="chec02">原商机不在</label></li>
											<li><input type="radio" name="b" id="chec03" checked="checked"/><label for="chec03">新需求</label></li>
										</ul>
									</div>
								</div>
							</div>
							<div class="informactionTow_tab" >
								<div class="visitor_input">
									<label>求购关键词：</label>
									<input type="text" id="word_input" placeholder="请输入产品名称，如有多个产品，用“，”隔开" />
									<button id="word_submit">添加+</button>
								</div>
								<div class="visitorWords" id="visitorWords">
								</div>
								<div class="visitorForm clearfix">
									<ul class="visitorForm_list1">
										<li>
											<label>求购数量：</label>
											<input type="text" />
										</li>
										<li>
											<label>访客联系人：</label>
											<input type="text" />	
										</li>
										<li>
											<label>微信/QQ：</label>
											<input type="text" />
										</li>
									</ul>
									<ul class="visitorForm_list2">
										<li>
											<label>访客地区：</label>
											<select name="省">
												<option value="">河北</option>
											</select>
											<select name="市">
												<option value="">保定</option>
											</select>
											<select name="县">
												<option value="">白洋淀</option>
											</select>
										</li>
										<li>
											<label>访客联系手机号：</label>
											<input type="text" placeholder="18605883667" />
										</li>
									</ul>
								</div>
								<div class="remarks">
									<label>详情：</label>
									<textarea name=""  placeholder=""></textarea>
								</div>
							</div>
						</div>
						<div class="visitor_abt">
							<button>取消</button>
							<button class="visitor_submit">保存</button>
						</div>
					</div>

					<!---->
				</div>
			</div>
		</div>
		<script src="https://groverjun.github.io/doufu/js/jquery-3.1.1.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var visitorWords='1,2,3,,,,,';
			var visitorWordsArr=[];
			//回显数据
			establishNode(visitorWords,function(html){
				$("#visitorWords").html(html)
			})
			//添加
			$("#word_submit").click(function(){
				establishNode($("#word_input").val(),function(html,SpareArr){
					
					//添加成功
					console.log(visitorWordsArr)//更新数据；
					$("#visitorWords").html(html);
					$("#word_input").val('')
					$("#visitor_height").height($(".visitor_box").height()+20)
					
					//添加失败
					console.log("=====================")
					/*
					        如果失败：重新赋值
					 	visitorWordsArr=SpareArr
					 */
					console.log(SpareArr)
				})
			});
			//删除
			$("#visitorWords").on('click','.wordDel',function(){
				var index=$(this).parent().index();
				var delWord=visitorWordsArr[index];
				console.log(delWord)//删除的值
				var conf=confirm("确定要删除吗？");
				if (conf==true){
				  	//删除成功后
					$("#visitorWords .purchaseAlertBox_listP").eq(index).remove();
					$("#visitor_height").height($(".visitor_box").height()+20)
					visitorWordsArr.splice(index,1);
					console.log(visitorWordsArr)//删除后更新的值
				}
			});
			//关闭
			$(".visitor").click(function(e){
				 $(this).hide();
				 $("#scrollbar").html("")
				  e.stopPropagation();   
			});
			$(".visitor_abt button").eq(0).click(function(){
				$(".visitor").click()
			})
			$("#visitor_height").click(function(e){
				e.stopPropagation(); 
			})
			$("#abt").click(function(){
				$(".visitor").show();
				$("#visitor_height").height($(".visitor_box").height()+20)
				$("#scrollbar").html("body::-webkit-scrollbar {display: none;}")
			})
			
			//tab切换
			$("#chec01").click(function(){
				$(".informactionTow_tab").hide();
				$("#visitor_height").height($(".visitor_box").height()+20)
			});
			$("#chec02").click(function(){
				$(".informactionTow_tab").hide();
				$("#visitor_height").height($(".visitor_box").height()+20)
			});
			$("#chec03").click(function(){
				$(".informactionTow_tab").eq(0).show().siblings(".informactionTow_tab").hide();
				$("#visitor_height").height($(".visitor_box").height()+20)
			});
			//收起
			$(".clearDiv").click(function(){
				console.log()
				if($(this).html()=="收起"){
					$(".top").eq($(this).attr("index")).hide();
					$(this).html("打开")
				}else{
					$(".top").eq($(this).attr("index")).show()
					$(this).html("收起")
				}
				$("#visitor_height").height($(".visitor_box").height()+20)
			})
			//添加节点函数
			function establishNode(str,fun){
				var reg = /[\u3002|\.|/;|/'|/,|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/g;
				var colIndex=-1;
				var list='';
				var color=["#1D7DFF","#5CB85C","#5BC0DE","#F0AD4E","#D9534F"];
				var num=Math.floor(Math.random()*5+1);
				var strName=str.replace(/\s/g,"");
				var SpareArr=visitorWordsArr;
				strName = strName.replace(reg, ',');
				strName = strName.split(",");
				strName = strName.filter(item => item);//去空
				strName = Array.from(new Set(strName));//去重
				visitorWordsArr=visitorWordsArr.concat(strName);
				visitorWordsArr=Array.from(new Set(visitorWordsArr));//去重
				for(var i=0;i<=visitorWordsArr.length-1;i++){
					colIndex+=1;
					if(visitorWordsArr.length==1){
						colIndex=num;
					}
					if(color[colIndex]==undefined){
						colIndex=0;
					}
					list+="<p class=\"purchaseAlertBox_listP\" style=\"border-color:" + color[colIndex] + ";color:" + color[colIndex] + " ;\">" + visitorWordsArr[i] + "<i class=\"wordDel\"  style=\"background:" + color[colIndex] + " ;\">-</i></p>";
				}
				fun(list,SpareArr)
			}
			$("#word_input").keydown(function(e){
				if (e.keyCode == 13) {$("#word_submit").click()}
			})
		</script>
	</body>
</html>
